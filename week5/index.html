<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ 5 - –§—ñ–∑–∏—á–Ω–∞ –º–æ–¥–µ–ª—å –°–æ–Ω—è—á–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏</title>
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 5px;
            z-index: 1000;
        }
        
        #info h3 {
            margin: 0 0 10px 0;
        }
        
        #controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 5px;
            z-index: 1000;
        }
        
        button {
            margin: 5px;
            padding: 8px 15px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            font-size: 14px;
        }
        
        button:hover {
            background: #45a049;
        }
        
        #massControl {
            margin-top: 10px;
        }
        
        input[type="number"] {
            width: 50px;
            padding: 5px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div id="info">
        <h3>–§—ñ–∑–∏—á–Ω–∞ –º–æ–¥–µ–ª—å –°–æ–Ω—è—á–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏</h3>
        <p>–†–µ–∞–ª—å–Ω–∞ –≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ–π–Ω–∞ –≤–∑–∞—î–º–æ–¥—ñ—è</p>
        <p id="timeInfo">–ß–∞—Å: 0 –¥–Ω—ñ–≤</p>
        <p id="speedInfo">–®–≤–∏–¥–∫—ñ—Å—Ç—å: 1x</p>
    </div>
    
    <div id="controls">
        <button onclick="togglePause()">‚è∏Ô∏è –ü–∞—É–∑–∞/–°—Ç–∞—Ä—Ç</button>
        <button onclick="changeSpeed(0.5)">üêå 0.5x</button>
        <button onclick="changeSpeed(1)">‚ñ∂Ô∏è 1x</button>
        <button onclick="changeSpeed(2)">‚è© 2x</button>
        <button onclick="changeSpeed(5)">‚è≠Ô∏è 5x</button>
        <div id="massControl">
            <button onclick="addMassiveObject()">üåü –î–æ–¥–∞—Ç–∏ –æ–±'—î–∫—Ç</button>
            <label>–ú–∞—Å–∞: 10^<input type="number" id="massExponent" value="25" min="20" max="30"></label>
        </div>
        <button onclick="resetSimulation()">üîÑ –°–∫–∏–Ω—É—Ç–∏</button>
    </div>

    <a-scene 
        embedded
        arjs="sourceType: webcam; 
              debugUIEnabled: false; 
              trackingMethod: best;
              detectionMode: mono_and_matrix; 
              matrixCodeType: 3x3;
              maxDetectionRate: 60;"
        renderer="logarithmicDepthBuffer: true; 
                 antialias: true; 
                 alpha: true; 
                 precision: high;
                 colorManagement: true;
                 physicallyCorrectLights: true;"
        vr-mode-ui="enabled: false">
        
        <!-- –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è -->
        <a-light type="ambient" color="#ffffff" intensity="0.3"></a-light>
        <a-light type="point" position="0 0 0" color="#ffffff" intensity="2" decay="2"></a-light>
        
        <!-- AR –º–∞—Ä–∫–µ—Ä Hiro -->
        <a-marker preset="hiro" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
            <a-entity id="solarSystem" scale="0.01 0.01 0.01" rotation="-90 0 0">
                
                <!-- –°–æ–Ω—Ü–µ -->
                <a-sphere id="sun" position="0 0 0" radius="20" src="../textures/sun.jpg" 
                         emissive="#ffaa00" emissive-intensity="0.5"
                         animation="property: material.emissiveIntensity; from: 0.3; to: 0.7; dir: alternate; dur: 5000; loop: true">
                    <a-entity planet="name: Sun; mass: 1.989e30; year: 0; dist: 0"></a-entity>
                </a-sphere>
                
                <!-- –ú–µ—Ä–∫—É—Ä—ñ–π -->
                <a-sphere position="0 0 0" radius="2.44" src="../textures/mercury.jpg" metalness="0.7">
                    <a-entity planet="name: Mercury; mass: 3.301e23; year: 87.97; dist: 57.9e9"></a-entity>
                </a-sphere>
                
                <!-- –í–µ–Ω–µ—Ä–∞ -->
                <a-sphere position="0 0 0" radius="6.05" src="../textures/venus.jpg">
                    <a-entity planet="name: Venus; mass: 4.867e24; year: 224.7; dist: 108.2e9"></a-entity>
                </a-sphere>
                
                <!-- –ó–µ–º–ª—è -->
                <a-entity id="earthSystem" position="0 0 0">
                    <a-sphere radius="6.371" src="../textures/earth.jpg">
                        <a-entity planet="name: Earth; mass: 5.972e24; year: 365.25; dist: 149.6e9"></a-entity>
                    </a-sphere>
                    <!-- –ú—ñ—Å—è—Ü—å (—Å–ø—Ä–æ—â–µ–Ω–æ - –æ–±–µ—Ä—Ç–∞—î—Ç—å—Å—è —Ä–∞–∑–æ–º –∑ –ó–µ–º–ª–µ—é) -->
                    <a-entity animation="property: rotation; to: 0 360 0; loop: true; dur: 27000">
                        <a-sphere position="10 0 0" radius="1.737" src="../textures/moon.jpg"></a-sphere>
                    </a-entity>
                </a-entity>
                
                <!-- –ú–∞—Ä—Å -->
                <a-sphere position="0 0 0" radius="3.39" src="../textures/mars.jpg">
                    <a-entity planet="name: Mars; mass: 6.417e23; year: 687; dist: 227.9e9"></a-entity>
                </a-sphere>
                
                <!-- –Æ–ø—ñ—Ç–µ—Ä -->
                <a-sphere position="0 0 0" radius="15" src="../textures/jupiter.jpg">
                    <a-entity planet="name: Jupiter; mass: 1.899e27; year: 4333; dist: 778.5e9"></a-entity>
                </a-sphere>
                
                <!-- –°–∞—Ç—É—Ä–Ω -->
                <a-entity position="0 0 0">
                    <a-sphere radius="10" src="../textures/saturn.jpg">
                        <a-entity planet="name: Saturn; mass: 5.685e26; year: 10759; dist: 1434e9"></a-entity>
                    </a-sphere>
                    <!-- –ö—ñ–ª—å—Ü—è –°–∞—Ç—É—Ä–Ω–∞ -->
                    <a-torus position="0 0 0" rotation="90 0 0" radius="15" radius-tubular="0.1" 
                            segments-radial="64" segments-tubular="64" color="#c8b882" opacity="0.8"></a-torus>
                    <a-torus position="0 0 0" rotation="90 0 0" radius="18" radius-tubular="0.1" 
                            segments-radial="64" segments-tubular="64" color="#a89968" opacity="0.6"></a-torus>
                    <a-torus position="0 0 0" rotation="90 0 0" radius="20" radius-tubular="0.05" 
                            segments-radial="64" segments-tubular="64" color="#887755" opacity="0.4"></a-torus>
                </a-entity>
                
                <!-- –û—Ä–±—ñ—Ç–∞–ª—å–Ω—ñ —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó -->
                <a-entity id="orbits"></a-entity>
                
                <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω—ñ —Ç–∞–±–ª–∏—á–∫–∏ –¥–ª—è –ø–ª–∞–Ω–µ—Ç -->
                <a-entity id="planetLabels"></a-entity>
                
            </a-entity>
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏
        const G = 6.67430e-11; // –ì—Ä–∞–≤—ñ—Ç–∞—Ü—ñ–π–Ω–∞ —Å—Ç–∞–ª–∞
        const SUN_MASS = 1.989e30; // –ú–∞—Å–∞ –°–æ–Ω—Ü—è
        const AU = 149.6e9; // –ê—Å—Ç—Ä–æ–Ω–æ–º—ñ—á–Ω–∞ –æ–¥–∏–Ω–∏—Ü—è –≤ –º–µ—Ç—Ä–∞—Ö
        const SCALE = 1000000000; // –ú–∞—Å—à—Ç–∞–± –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó (1 –º–ª–Ω –∫–º = 1 –º)
        
        // –ó–º—ñ–Ω–Ω—ñ —Å–∏–º—É–ª—è—Ü—ñ—ó
        let planets = [];
        let isPaused = false;
        let simulationTime = 0;
        let timeSpeed = 1;
        let massiveObject = null;
        let dt = 86400 / 3; // –ö—Ä–æ–∫ —Å–∏–º—É–ª—è—Ü—ñ—ó (1/3 –¥–Ω—è)
        
        // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ planet
        AFRAME.registerComponent('planet', {
            schema: {
                name: {type: 'string'},
                mass: {type: 'number'},
                year: {type: 'number'},
                dist: {type: 'number'}
            },
            
            init: function() {
                // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                const x = this.data.dist / SCALE;
                this.el.setAttribute('position', {x: x, y: 0, z: 0});
                
                // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –æ—Ä–±—ñ—Ç–∞–ª—å–Ω–æ—ó —à–≤–∏–¥–∫–æ—Å—Ç—ñ
                let orbitalVelocity = 0;
                if (this.data.dist > 0) {
                    orbitalVelocity = Math.sqrt(G * SUN_MASS / this.data.dist);
                }
                
                // –ü–æ—á–∞—Ç–∫–æ–≤–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å (–ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω–æ —Ä–∞–¥—ñ—É—Å—É)
                this.v = [0, 0, orbitalVelocity];
                
                // –î–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ –º–∞—Å–∏–≤—É –ø–ª–∞–Ω–µ—Ç
                const planetData = {
                    el: this.el,
                    name: this.data.name,
                    mass: this.data.mass,
                    year: this.data.year,
                    dist: this.data.dist,
                    pos: [this.data.dist, 0, 0],
                    v: this.v,
                    a: [0, 0, 0],
                    trail: [],
                    maxTrailLength: 50
                };
                
                planets.push(planetData);
                
                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ—Ä–±—ñ—Ç–∞–ª—å–Ω–æ—ó —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó
                if (this.data.name !== 'Sun') {
                    this.createOrbitPath();
                    this.createLabel();
                }
            },
            
            createOrbitPath: function() {
                const orbits = document.getElementById('orbits');
                const orbit = document.createElement('a-ring');
                orbit.setAttribute('radius-inner', (this.data.dist / SCALE) - 0.5);
                orbit.setAttribute('radius-outer', (this.data.dist / SCALE) + 0.5);
                orbit.setAttribute('rotation', '90 0 0');
                orbit.setAttribute('opacity', '0.2');
                orbit.setAttribute('color', '#ffffff');
                orbit.setAttribute('segments-theta', '64');
                orbits.appendChild(orbit);
            },
            
            createLabel: function() {
                const labels = document.getElementById('planetLabels');
                const label = document.createElement('a-text');
                label.setAttribute('value', this.data.name);
                label.setAttribute('position', {
                    x: this.data.dist / SCALE,
                    y: 10,
                    z: 0
                });
                label.setAttribute('align', 'center');
                label.setAttribute('color', '#ffffff');
                label.setAttribute('width', '40');
                labels.appendChild(label);
            }
        });
        
        // –§—É–Ω–∫—Ü—ñ—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ–π–Ω–∏—Ö —Å–∏–ª
        function calculateGravity() {
            if (isPaused) return;
            
            const currentDt = dt * timeSpeed;
            simulationTime += currentDt;
            
            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
            document.getElementById('timeInfo').textContent = 
                `–ß–∞—Å: ${Math.floor(simulationTime / 86400)} –¥–Ω—ñ–≤ (${(simulationTime / 86400 / 365.25).toFixed(2)} —Ä–æ–∫—ñ–≤)`;
            
            // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è –¥–ª—è –≤—Å—ñ—Ö –ø–ª–∞–Ω–µ—Ç
            for (let i = 0; i < planets.length; i++) {
                planets[i].a = [0, 0, 0];
                
                for (let j = 0; j < planets.length; j++) {
                    if (i !== j) {
                        // –í–µ–∫—Ç–æ—Ä –≤—ñ–¥—Å—Ç–∞–Ω—ñ –º—ñ–∂ –ø–ª–∞–Ω–µ—Ç–∞–º–∏
                        let r = [
                            planets[j].pos[0] - planets[i].pos[0],
                            planets[j].pos[1] - planets[i].pos[1],
                            planets[j].pos[2] - planets[i].pos[2]
                        ];
                        
                        // –ú–æ–¥—É–ª—å –≤—ñ–¥—Å—Ç–∞–Ω—ñ
                        let dist = Math.sqrt(r[0]*r[0] + r[1]*r[1] + r[2]*r[2]);
                        
                        // –£–Ω–∏–∫–Ω–µ–Ω–Ω—è –¥—ñ–ª–µ–Ω–Ω—è –Ω–∞ –Ω—É–ª—å
                        if (dist < 1e6) dist = 1e6;
                        
                        // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è
                        const factor = G * planets[j].mass / Math.pow(dist, 3);
                        for (let k = 0; k < 3; k++) {
                            planets[i].a[k] += factor * r[k];
                        }
                    }
                }
            }
            
            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ —Ç–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (–º–µ—Ç–æ–¥ –í–µ—Ä–ª–µ)
            for (let i = 0; i < planets.length; i++) {
                const planet = planets[i];
                
                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ
                for (let k = 0; k < 3; k++) {
                    planet.v[k] += planet.a[k] * currentDt;
                    planet.pos[k] += planet.v[k] * currentDt;
                }
                
                // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó
                if (planet.name !== 'Sun') {
                    planet.trail.push([...planet.pos]);
                    if (planet.trail.length > planet.maxTrailLength) {
                        planet.trail.shift();
                    }
                }
                
                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—ó 3D-–æ–±'—î–∫—Ç–∞
                planet.el.setAttribute('position', {
                    x: planet.pos[0] / SCALE,
                    y: planet.pos[1] / SCALE,
                    z: planet.pos[2] / SCALE
                });
            }
        }
        
        // –ó–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ü—ñ—ó
        setInterval(calculateGravity, 50);
        
        // –§—É–Ω–∫—Ü—ñ—ó —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
        function togglePause() {
            isPaused = !isPaused;
        }
        
        function changeSpeed(speed) {
            timeSpeed = speed;
            document.getElementById('speedInfo').textContent = `–®–≤–∏–¥–∫—ñ—Å—Ç—å: ${speed}x`;
        }
        
        function addMassiveObject() {
            if (massiveObject) {
                massiveObject.parentNode.removeChild(massiveObject);
                planets = planets.filter(p => p.name !== 'MassiveObject');
            }
            
            const exponent = document.getElementById('massExponent').value;
            const mass = Math.pow(10, exponent);
            
            const solarSystem = document.getElementById('solarSystem');
            massiveObject = document.createElement('a-sphere');
            massiveObject.setAttribute('position', '300 0 0');
            massiveObject.setAttribute('radius', '8');
            massiveObject.setAttribute('color', '#ff0000');
            massiveObject.setAttribute('opacity', '0.8');
            massiveObject.setAttribute('emissive', '#ff0000');
            massiveObject.setAttribute('emissive-intensity', '0.3');
            massiveObject.innerHTML = `<a-entity planet="name: MassiveObject; mass: ${mass}; year: 0; dist: 300e9"></a-entity>`;
            
            solarSystem.appendChild(massiveObject);
            
            // –î–æ–¥–∞—î–º–æ –µ—Ñ–µ–∫—Ç –ø—É–ª—å—Å–∞—Ü—ñ—ó
            massiveObject.setAttribute('animation', 'property: scale; to: 1.2 1.2 1.2; dir: alternate; dur: 2000; loop: true');
        }
        
        function resetSimulation() {
            location.reload();
        }
    </script>
</body>
</html>
