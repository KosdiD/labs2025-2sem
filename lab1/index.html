<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
</head>
<body>
    <a-scene physics="gravity: -9.8; debug: false" background="color: #1a1a1a">
        <!-- Assets -->
        <a-assets>
            <img id="hardwood" src="../textures/hardwood.jpg" crossorigin="anonymous">
            <img id="disturb" src="../textures/disturb.jpg" crossorigin="anonymous">
        </a-assets>

        <!-- Lights -->
        <a-light type="ambient" intensity="0.5"></a-light>
        <a-light type="directional" position="2 10 2" intensity="0.8" castShadow="true"></a-light>

        <!-- Inclined Plane - 30 degrees -->
        <a-box 
            id="plane"
            static-body="shape: box"
            position="0 0 -5" 
            rotation="-30 0 0"
            width="4" 
            height="0.2" 
            depth="10"
            material="src: #disturb; repeat: 2 5"
            shadow="receive: true">
        </a-box>

        <!-- Bottom catch plane -->
        <a-plane 
            static-body
            position="0 -3 -5" 
            rotation="-90 0 0" 
            width="20" 
            height="20" 
            material="color: #111; opacity: 0.8"
            shadow="receive: true">
        </a-plane>

        <!-- Main Cylinder -->
        <a-cylinder 
            id="main-cylinder"
            dynamic-body="shape: cylinder; cylinderAxis: x"
            position="-1 3 -7"
            rotation="0 0 90"
            radius="0.3" 
            height="0.8"
            material="src: #hardwood; repeat: 2 1"
            shadow="cast: true">
        </a-cylinder>

        <!-- Force Vectors Group -->
        <a-entity id="force-vectors">
            <!-- Weight Vector (mg) - Always points down -->
            <a-entity id="weight-vector" position="-1 3 -7">
                <a-cylinder 
                    position="0 0 0" 
                    radius="0.03" 
                    height="1.2" 
                    material="color: #ff0000; emissive: #ff0000; emissiveIntensity: 0.2">
                </a-cylinder>
                <a-cone 
                    position="0 -0.6 0" 
                    radius-bottom="0.15" 
                    radius-top="0" 
                    height="0.3" 
                    material="color: #ff0000; emissive: #ff0000; emissiveIntensity: 0.2">
                </a-cone>
                <a-text 
                    value="mg" 
                    position="0.4 0 0" 
                    scale="1 1 1" 
                    align="center"
                    material="color: #ff0000">
                </a-text>
            </a-entity>

            <!-- Normal Force Vector - Perpendicular to plane -->
            <a-entity id="normal-vector" position="-1 3 -7">
                <a-entity rotation="30 0 0">
                    <a-cylinder 
                        position="0 0.6 0" 
                        radius="0.03" 
                        height="1.2" 
                        material="color: #0080ff; emissive: #0080ff; emissiveIntensity: 0.2">
                    </a-cylinder>
                    <a-cone 
                        position="0 1.2 0" 
                        radius-bottom="0.15" 
                        radius-top="0" 
                        height="0.3" 
                        material="color: #0080ff; emissive: #0080ff; emissiveIntensity: 0.2">
                    </a-cone>
                </a-entity>
                <a-text 
                    value="N" 
                    position="0.4 0.8 0" 
                    scale="1 1 1" 
                    align="center"
                    material="color: #0080ff">
                </a-text>
            </a-entity>

            <!-- Friction Force Vector - Along plane, opposing motion -->
            <a-entity id="friction-vector" position="-1 3 -7">
                <a-entity rotation="0 0 0">
                    <a-cylinder 
                        position="-0.5 0.3 0" 
                        radius="0.03" 
                        height="1" 
                        rotation="0 0 60" 
                        material="color: #00ff00; emissive: #00ff00; emissiveIntensity: 0.2">
                    </a-cylinder>
                    <a-cone 
                        position="-0.8 0.5 0" 
                        radius-bottom="0.15" 
                        radius-top="0" 
                        height="0.3" 
                        rotation="0 0 -30" 
                        material="color: #00ff00; emissive: #00ff00; emissiveIntensity: 0.2">
                    </a-cone>
                </a-entity>
                <a-text 
                    value="f" 
                    position="-0.4 0.6 0" 
                    scale="1 1 1" 
                    align="center"
                    material="color: #00ff00">
                </a-text>
            </a-entity>
        </a-entity>

        <!-- Info Text -->
        <a-text 
            value="Cylinder on 30Â° Incline\nRed: Weight (mg)\nBlue: Normal Force (N)\nGreen: Friction (f)" 
            position="-3 5 -5" 
            scale="0.8 0.8 0.8" 
            align="left"
            material="color: white">
        </a-text>

        <!-- Camera with WASD controls -->
        <a-entity position="0 2 2">
            <a-camera wasd-controls="acceleration: 20" look-controls>
                <a-cursor 
                    geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                    material="color: white; shader: flat">
                </a-cursor>
            </a-camera>
        </a-entity>
    </a-scene>

    <script>
        // Update force vectors to follow cylinder
        AFRAME.registerComponent('update-vectors', {
            tick: function() {
                const cylinder = document.querySelector('#main-cylinder');
                const vectors = ['#weight-vector', '#normal-vector', '#friction-vector'];
                
                if (cylinder && cylinder.body) {
                    const pos = cylinder.getAttribute('position');
                    
                    vectors.forEach(vectorId => {
                        const vector = document.querySelector(vectorId);
                        if (vector) {
                            vector.setAttribute('position', {
                                x: pos.x,
                                y: pos.y,
                                z: pos.z
                            });
                        }
                    });
                }
            }
        });

        // Apply the component
        document.querySelector('a-scene').setAttribute('update-vectors', '');

        // Spawn new cylinders repeatedly
        function spawnCylinder() {
            const scene = document.querySelector('a-scene');
            const cylinder = document.createElement('a-cylinder');
            
            cylinder.setAttribute('dynamic-body', 'shape: cylinder; cylinderAxis: x');
            cylinder.setAttribute('position', {
                x: -1 + (Math.random() - 0.5) * 0.5,
                y: 3,
                z: -7
            });
            cylinder.setAttribute('rotation', '0 0 90');
            cylinder.setAttribute('radius', 0.2 + Math.random() * 0.2);
            cylinder.setAttribute('height', 0.6 + Math.random() * 0.4);
            cylinder.setAttribute('material', {
                color: `hsl(${Math.random() * 360}, 70%, 50%)`,
                metalness: 0.3,
                roughness: 0.7
            });
            cylinder.setAttribute('shadow', 'cast: true');
            
            scene.appendChild(cylinder);
            
            // Remove after some time to prevent too many objects
            setTimeout(() => {
                if (cylinder.parentNode) {
                    cylinder.parentNode.removeChild(cylinder);
                }
            }, 15000);
        }

        // Spawn cylinders every 4 seconds
        setInterval(spawnCylinder, 4000);

        // Reset main cylinder if it falls too far
        setInterval(() => {
            const cylinder = document.querySelector('#main-cylinder');
            if (cylinder && cylinder.body) {
                const pos = cylinder.getAttribute('position');
                if (pos.y < -5) {
                    // Reset position
                    cylinder.body.position.set(-1, 3, -7);
                    cylinder.body.velocity.set(0, 0, 0);
                    cylinder.body.angularVelocity.set(0, 0, 0);
                }
            }
        }, 500);

        // Wait for physics to initialize
        setTimeout(() => {
            console.log('Physics scene ready');
        }, 1000);
    </script>
</body>
</html>
