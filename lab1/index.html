<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
</head>
<body>
    <a-scene physics="gravity: -9.8" background="color: #333">
        <!-- Assets -->
        <a-assets>
            <img id="hardwood" src="../textures/hardwood.jpg">
            <img id="disturb" src="../textures/disturb.jpg">
        </a-assets>

        <!-- Lights -->
        <a-light type="ambient" intensity="0.4"></a-light>
        <a-light type="directional" position="0 10 0" intensity="0.6"></a-light>

        <!-- Inclined Plane - 30 degrees -->
        <a-box 
            id="plane"
            static-body
            position="0 2 -8" 
            rotation="-30 0 0"
            width="3" 
            height="0.1" 
            depth="8"
            material="src: #disturb; repeat: 2 4">
        </a-box>

        <!-- Cylinder -->
        <a-cylinder 
            id="cylinder"
            dynamic-body="shape: cylinder"
            position="0 5.5 -10.5"
            rotation="0 0 90"
            radius="0.4" 
            height="1"
            material="src: #hardwood; repeat: 3 1">
        </a-cylinder>

        <!-- Force Vectors attached to cylinder -->
        <a-entity id="forces">
            <!-- Weight (mg) - Down -->
            <a-entity id="weight" position="0 5.5 -10.5">
                <a-cylinder position="0 -0.5 0" radius="0.02" height="1" color="red"></a-cylinder>
                <a-cone position="0 -1 0" radius-bottom="0.1" radius-top="0" height="0.2" color="red"></a-cone>
                <a-text value="mg" position="0.3 -0.5 0" scale="0.8 0.8 0.8" color="red"></a-text>
            </a-entity>

            <!-- Normal Force - Perpendicular to plane -->
            <a-entity id="normal" position="0 5.5 -10.5" rotation="-30 0 0">
                <a-cylinder position="0 0.5 0" radius="0.02" height="1" color="blue"></a-cylinder>
                <a-cone position="0 1 0" radius-bottom="0.1" radius-top="0" height="0.2" color="blue"></a-cone>
                <a-text value="N" position="0.3 0.5 0" scale="0.8 0.8 0.8" color="blue"></a-text>
            </a-entity>

            <!-- Friction - Up the plane -->
            <a-entity id="friction" position="0 5.5 -10.5" rotation="0 0 30">
                <a-cylinder position="-0.4 0 0" radius="0.02" height="0.8" rotation="0 0 90" color="green"></a-cylinder>
                <a-cone position="-0.8 0 0" radius-bottom="0.1" radius-top="0" height="0.2" rotation="0 0 -90" color="green"></a-cone>
                <a-text value="f" position="0 0.3 0" scale="0.8 0.8 0.8" color="green"></a-text>
            </a-entity>
        </a-entity>

        <!-- Camera with WASD controls -->
        <a-entity position="0 3 0">
            <a-camera wasd-controls look-controls>
                <a-cursor geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"></a-cursor>
            </a-camera>
        </a-entity>

        <!-- Ground -->
        <a-plane 
            static-body
            position="0 0 -8" 
            rotation="-90 0 0" 
            width="20" 
            height="20" 
            color="#222">
        </a-plane>
    </a-scene>

    <script>
        // Follow cylinder with force vectors
        AFRAME.registerComponent('follow-cylinder', {
            tick: function() {
                const cylinder = document.querySelector('#cylinder');
                const weight = document.querySelector('#weight');
                const normal = document.querySelector('#normal');
                const friction = document.querySelector('#friction');
                
                if (cylinder && weight && normal && friction) {
                    const pos = cylinder.getAttribute('position');
                    weight.setAttribute('position', pos);
                    normal.setAttribute('position', pos);
                    friction.setAttribute('position', pos);
                }
            }
        });

        document.querySelector('#forces').setAttribute('follow-cylinder', '');

        // Reset cylinder position when it falls off
        setInterval(() => {
            const cylinder = document.querySelector('#cylinder');
            if (cylinder) {
                const pos = cylinder.getAttribute('position');
                if (pos.y < -5) {
                    cylinder.body.position.set(0, 5.5, -10.5);
                    cylinder.body.velocity.set(0, 0, 0);
                    cylinder.body.angularVelocity.set(0, 0, 0);
                }
            }
        }, 100);

        // Add repetitive spawning
        setInterval(() => {
            const scene = document.querySelector('a-scene');
            const newCylinder = document.createElement('a-cylinder');
            
            newCylinder.setAttribute('dynamic-body', 'shape: cylinder');
            newCylinder.setAttribute('position', '0 5.5 -10.5');
            newCylinder.setAttribute('rotation', '0 0 90');
            newCylinder.setAttribute('radius', 0.3 + Math.random() * 0.2);
            newCylinder.setAttribute('height', 0.8 + Math.random() * 0.4);
            newCylinder.setAttribute('material', `src: #hardwood; repeat: 3 1`);
            
            scene.appendChild(newCylinder);
            
            // Remove after 10 seconds
            setTimeout(() => {
                newCylinder.parentNode.removeChild(newCylinder);
            }, 10000);
        }, 3000);
    </script>
</body>
</html>
