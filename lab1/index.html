<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Rolling Cylinder Example</title>
    <!-- Підключення Ammo.js -->
    <script src="https://mixedreality.mozilla.org/ammo.js/builds/ammo.wasm.js"></script>
    <!-- Підключення aframe-physics-system -->
    <script src="http://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
  </head>
  <body>
    <a-scene physics="driver: ammo; debug: true; debugDrawMode: 1">
      <!-- Статична площина як підлога -->
      <a-plane 
        ammo-body="type: static" 
        ammo-shape="type: box"
        position="0 0 0" 
        rotation="-90 0 0" 
        width="20" 
        height="20" 
        color="#7BC8A4">
      </a-plane>

      <!-- Динамічний циліндр, що буде скатуватися -->
      <a-cylinder 
        id="rollingCylinder"
        geometry="primitive: cylinder; height: 2; radius: 0.5"
        material="color: red"
        position="0 1 0"
        ammo-body="type: dynamic; mass: 1; linearDamping: 0.2; angularDamping: 0.2; friction: 0.5;"
        ammo-shape="type: cylinder">
      </a-cylinder>

      <!-- Камера для спостереження за сценою -->
      <a-entity camera position="0 5 10" look-controls wasd-controls></a-entity>

      <script>
        // Компонент для застосування початкового імпульсу до циліндра,
        // щоб він одразу отримав рух (і, можливо, почав обертатись).
        AFRAME.registerComponent('apply-impulse-on-load', {
          init: function () {
            var el = this.el;
            el.addEventListener('body-loaded', function () {
              // Створюємо вектор імпульсу: напрямок за оссю X
              var impulse = new Ammo.btVector3(4, 0, 0);
              // Вектор положення відносно центра тіла
              var relPos = new Ammo.btVector3(0, 0, 0);
              // Застосовуємо імпульс до тіла циліндра
              el.body.applyImpulse(impulse, relPos);
              // Звільняємо пам'ять, що виділена для векторів
              Ammo.destroy(impulse);
              Ammo.destroy(relPos);
            });
          }
        });

        // Додаємо компонент до циліндра після завантаження DOM
        document.addEventListener('DOMContentLoaded', function () {
          var cylinder = document.querySelector('#rollingCylinder');
          cylinder.setAttribute('apply-impulse-on-load', '');
        });
      </script>
    </a-scene>
  </body>
</html>
